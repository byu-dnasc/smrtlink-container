BootStrap: library
From: ubuntu:22.04

%files

    imported /opt/pacbio/imported

%post

    chmod +x /opt/pacbio/imported # make imported files executable

    apt-get update
    apt-get install -y rsync
    apt-get install -y locales
    apt-get install -y iproute2 # includes ss
    apt-get clean

    localedef -i en_US -c -f UTF-8 -A /usr/share/locale/locale.alias en_US.UTF-8

    mkdir -p /opt/pacbio # ideally, install here

%environment

    export LANG=en_US.utf8
    export SMRT_ROOT=/home/{{ user }}/smrtlink-container/smrtlink
    export PATH=$PATH:$SMRT_ROOT/admin/bin

%startscript

    echo "[$NOW] Start script initiated..."

    output=$(services-start)
    exit_code=$?

    awk '{ print " + " $0 }' <<< "$output"

    if [ $exit_code -ne 0 ]; then
        echo "SMRT Link exited non-zero."
    fi
    echo "[$NOW] Start script complete." 